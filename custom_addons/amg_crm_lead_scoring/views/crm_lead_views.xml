<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Form View -->
    <record id="view_crm_lead_form_inherit_scoring" model="ir.ui.view">
        <field name="name">crm.lead.form.scoring</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='priority']" position="after">
                <field name="lead_score"
                       widget="progressbar"
                       options="{'max_value': 100, 'editable': false, 'edit': false}"
                       class="oe_inline"/>
            </xpath>
        </field>
    </record>

    <!-- Tree View -->
    <record id="view_crm_lead_tree_inherit_scoring" model="ir.ui.view">
        <field name="name">crm.lead.tree.scoring</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="lead_score"
                       widget="progressbar"
                       options="{'max_value': 100, 'editable': false}"
                       optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Action to recompute scores -->
    <record id="action_crm_lead_recompute_scores" model="ir.actions.server">
        <field name="name">Recompute Lead Scores</field>
        <field name="model_id" ref="model_crm_lead"/>
        <field name="state">code</field>
        <field name="code">
            records.action_recompute_scores()
        </field>
    </record>

    <!-- Add to More menu -->
    <record id="view_crm_lead_tree_inherit_scoring_actions" model="ir.ui.view">
        <field name="name">crm.lead.tree.scoring.actions</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <header>
                    <button
                        name="action_recompute_scores"
                        type="object"
                        string="Recompute Scores"
                        class="btn-secondary"/>
                </header>
            </xpath>
        </field>
    </record>
</odoo>